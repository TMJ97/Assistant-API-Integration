<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chat with OpenAI Assistant</title>
  </head>
  <body>
    <h1>Chat with OpenAI Assistant</h1>
    <div
      id="chatHistory"
      style="
        height: 300px;
        overflow-y: auto;
        border: 1px solid #ccc;
        padding: 10px;
      "
    >
      <!-- Chat messages will appear here -->
    </div>
    <input
      type="text"
      id="prompt"
      style="width: 80%; margin-top: 10px"
      onkeypress="if(event.keyCode==13) {sendPrompt(event);}"
    />
    <button onclick="sendPrompt(event)" style="width: 18%; margin-top: 10px">
      Send
    </button>
    <div id="loading" style="display: none">Loading...</div>

    <script>
      function sendPrompt(event) {
        event.preventDefault();
        const promptInput = document.getElementById("prompt");
        if (!promptInput.value.trim()) {
          alert("Please enter some text before sending.");
          return;
        }
        const loadingIndicator = document.getElementById("loading");
        loadingIndicator.style.display = "block";
        fetch("http://127.0.0.1:5000/generate", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ prompt: promptInput.value.trim() }),
        })
          .then((response) => response.json())
          .then((data) => {
            loadingIndicator.style.display = "none";
            if (data.message) {
              const chatHistory = document.getElementById("chatHistory");
              // Append user input and AI response to the chat history
              chatHistory.innerHTML += `<p><strong>User:</strong> ${promptInput.value}</p><p><strong>AI:</strong> ${data.message}</p>`;
              promptInput.value = ""; // Clear input after sending
              chatHistory.scrollTop = chatHistory.scrollHeight; // Scroll to the bottom
            } else {
              alert("Response error: " + data.error);
            }
          })
          .catch((error) => {
            loadingIndicator.style.display = "none";
            console.error("Error:", error);
            alert("An error occurred while sending your message.");
          });
      }
    </script>
  </body>
</html>
